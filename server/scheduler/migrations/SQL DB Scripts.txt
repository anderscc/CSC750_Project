BEGIN;
--
-- Create model Assignment
--
CREATE TABLE "scheduler_assignment" ("scheduleNum" integer NOT NULL PRIMARY KEY, "coursesAsn" varchar(255) NOT NULL, "hoursAsn" smallint unsigned NOT NULL CHECK ("hoursAsn" >= 0));
--
-- Create model GATA
--
CREATE TABLE "scheduler_gata" ("id" integer NOT NULL PRIMARY KEY, "studentName" varchar(100) NOT NULL, "hoursAvailable" smallint unsigned NOT NULL CHECK ("hoursAvailable" >= 0), "coursePref" varchar(255) NOT NULL, "facultyPref" varchar(255) NOT NULL, "officeHours" smallint unsigned NOT NULL CHECK 
("officeHours" >= 0), "classTimes" varchar(255) NOT NULL);
--
-- Create model SemesterYear
--
CREATE TABLE "scheduler_semesteryear" ("id" integer NOT NULL PRIMARY KEY, "Semester" varchar(30) NOT NULL, "Year" varchar(4) NOT NULL);
--
-- Create model Schedules
--
CREATE TABLE "scheduler_schedules" ("id" integer NOT NULL PRIMARY KEY, "conflicts" smallint unsigned NOT NULL CHECK ("conflicts" >= 0), "scheduleNum_id" integer NOT NULL REFERENCES "scheduler_assignment" ("scheduleNum") DEFERRABLE INITIALLY DEFERRED, "semYr_id" integer NOT NULL REFERENCES "scheduler_semesteryear" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Create model Labs
--
CREATE TABLE "scheduler_labs" ("id" integer NOT NULL PRIMARY KEY, "labCode" smallint unsigned NOT NULL CHECK ("labCode" >= 0), "labName" varchar(255) NOT NULL, "labFaculty" varchar(255) NOT NULL, "labSection" smallint unsigned NOT NULL CHECK ("labSection" >= 0), "labMeetTimes" varchar(100) NOT NULL, "activityTimes" varchar(255) NOT NULL, "GAPref_id" integer NOT NULL REFERENCES "scheduler_gata" ("id") DEFERRABLE INITIALLY DEFERRED, "semYr_id" integer NOT NULL REFERENCES "scheduler_semesteryear" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Add field semYr to gata
--
CREATE TABLE "new__scheduler_gata" ("id" integer NOT NULL PRIMARY KEY, "studentName" varchar(100) NOT NULL, "hoursAvailable" smallint unsigned NOT NULL CHECK ("hoursAvailable" >= 0), "coursePref" varchar(255) NOT NULL, "facultyPref" varchar(255) NOT NULL, "officeHours" smallint unsigned NOT NULL CHECK ("officeHours" >= 0), "classTimes" varchar(255) NOT NULL, "semYr_id" integer NOT NULL REFERENCES "scheduler_semesteryear" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "new__scheduler_gata" ("id", "studentName", "hoursAvailable", "coursePref", "facultyPref", "officeHours", "classTimes", "semYr_id") SELECT "id", "studentName", "hoursAvailable", "coursePref", "facultyPref", "officeHours", "classTimes", NULL FROM "scheduler_gata";
DROP TABLE "scheduler_gata";
ALTER TABLE "new__scheduler_gata" RENAME TO "scheduler_gata";
CREATE INDEX "scheduler_schedules_scheduleNum_id_022da73a" ON "scheduler_schedules" ("scheduleNum_id");
CREATE INDEX "scheduler_schedules_semYr_id_37ef19e9" ON "scheduler_schedules" ("semYr_id");
CREATE INDEX "scheduler_labs_GAPref_id_b42c31ef" ON "scheduler_labs" ("GAPref_id");
CREATE INDEX "scheduler_labs_semYr_id_61f66cb1" ON "scheduler_labs" ("semYr_id");
CREATE INDEX "scheduler_gata_semYr_id_b42cb5fc" ON "scheduler_gata" ("semYr_id");
--
-- Create model Courses
--
CREATE TABLE "scheduler_courses" ("id" integer NOT NULL PRIMARY KEY, "courseCode" smallint unsigned NOT NULL CHECK ("courseCode" >= 0), "courseName" varchar(255) NOT NULL, "courseSection" smallint unsigned NOT NULL CHECK ("courseSection" >= 0), "courseMeetTimes" varchar(100) NOT NULL, "courseFaculty" varchar(255) NOT NULL, "courseActivities" varchar(255) NOT NULL, "activityTimes" varchar(255) NOT NULL, "GAPref_id" integer NOT NULL REFERENCES "scheduler_gata" ("id") DEFERRABLE INITIALLY DEFERRED, "semYr_id" integer NOT NULL REFERENCES "scheduler_semesteryear" ("id") DEFERRABLE INITIALLY DEFERRED);
--
-- Add field id to assignment
--
CREATE TABLE "new__scheduler_assignment" ("scheduleNum" integer NOT NULL PRIMARY KEY, "coursesAsn" varchar(255) NOT NULL, "hoursAsn" smallint unsigned NOT NULL CHECK ("hoursAsn" >= 0), "id_id" integer NOT NULL REFERENCES "scheduler_gata" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "new__scheduler_assignment" ("scheduleNum", "coursesAsn", "hoursAsn", "id_id") SELECT "scheduleNum", "coursesAsn", "hoursAsn", NULL FROM "scheduler_assignment";
DROP TABLE "scheduler_assignment";
ALTER TABLE "new__scheduler_assignment" RENAME TO "scheduler_assignment";
CREATE INDEX "scheduler_courses_GAPref_id_3dce6792" ON "scheduler_courses" ("GAPref_id");
CREATE INDEX "scheduler_courses_semYr_id_96ecfc39" ON "scheduler_courses" ("semYr_id");
CREATE INDEX "scheduler_assignment_id_id_e793539c" ON "scheduler_assignment" ("id_id");
--
-- Add field semYr to assignment
--
CREATE TABLE "new__scheduler_assignment" ("scheduleNum" integer NOT NULL PRIMARY KEY, "coursesAsn" varchar(255) NOT NULL, "hoursAsn" smallint unsigned NOT NULL CHECK ("hoursAsn" >= 0), "id_id" integer NOT NULL REFERENCES "scheduler_gata" ("id") DEFERRABLE INITIALLY DEFERRED, "semYr_id" integer NOT NULL REFERENCES "scheduler_semesteryear" ("id") DEFERRABLE INITIALLY DEFERRED);
INSERT INTO "new__scheduler_assignment" ("scheduleNum", "coursesAsn", "hoursAsn", "id_id", "semYr_id") SELECT "scheduleNum", "coursesAsn", "hoursAsn", "id_id", NULL FROM "scheduler_assignment";
DROP TABLE "scheduler_assignment";
ALTER TABLE "new__scheduler_assignment" RENAME TO "scheduler_assignment";
CREATE INDEX "scheduler_assignment_id_id_e793539c" ON "scheduler_assignment" ("id_id");
CREATE INDEX "scheduler_assignment_semYr_id_69d06bbb" ON "scheduler_assignment" ("semYr_id");
COMMIT;